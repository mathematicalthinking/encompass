<header id="assignmentnewheader">
  <h2>
    Create New Assignment
  </h2>
  <div class="clear"></div>
</header>
<section class="third submissions">
  <form id="newassignmentform" class="properForm">
    <fieldset>
      <ol>
        <li>
          {{assignment-form-label
            for="section"
            text="Class"
            tagName=""
            star=true
            tooltip=tooltips.class
          }}
          <div class="flex-input">
            {{#if fromSectionInfo}}
              <p>
                {{selectedSection.name}}
              </p>
            {{else}}
              {{selectize-input
                inputId="assn-new-section-select"
                initialOptions=sectionOptions
                onItemAdd=(action "updateSelectizeSingle")
                onItemRemove=(action "updateSelectizeSingle")
                maxItems=1
                labelField="name"
                valueField="id"
                searchField="name"
                propToUpdate="selectedSection"
                placeholder="Search for a class by name"
                model="section"
                store=store
              }}
              {{input required=true type="hidden" value=selectedSection}}
              {{#each sectionFormErrors as |error|}}
                {{error-box
                  error=error
                  showDismiss=true
                  resetError=(action
                    "removeErrorFromArray" "sectionFormErrors" error
                  )
                }}
              {{/each}}
            {{/if}}
          </div>
        </li>
        <li class="problem">
          {{assignment-form-label
            for="text"
            text="Problem"
            star=true
            tooltip=tooltips.problem
            tagName=""
          }}
          {{#if fromProblemInfo}}
            <p>
              {{{selectedProblem.title}}}
            </p>
          {{else}}
            <div class="flex-input">
              {{selectize-input
                store=store
                inputId="assn-new-problem-select"
                initialOptions=problemOptions
                onItemAdd=(action "updateSelectizeSingle")
                onItemRemove=(action "updateSelectizeSingle")
                maxItems=1
                labelField="title"
                valueField="id"
                searchField="title"
                propToUpdate="selectedProblem"
                placeholder="Search for a problem by title"
                isAsync=true
                model="problem"
                queryParamsKey="query"
                searchCriterion="title"
                topLevelQueryParams="searchBy"
                preload=problemsPreloadValue
              }}
              {{#each problemFormErrors as |error|}}
                {{error-box
                  error=error
                  showDismiss=true
                  resetError=(action
                    "removeErrorFromArray" "problemFormErrors" error
                  )
                }}
              {{/each}}
            </div>
          {{/if}}
        </li>
        <li>
          {{assignment-form-label
            for="assignedDate"
            text="Date Assigned"
            tooltip=tooltips.dateAssigned
          }}
          <div class="flex-input">
            {{input
              id="assignedDate"
              name="daterange"
              type="text"
              value=assignedDate
              tagName=""
            }}
            {{#each assignedDateFormErrors as |error|}}
              <p class="error-message">
                {{error}}
              </p>
            {{/each}}
          </div>
        </li>
        <li>
          {{assignment-form-label
            for="dueDate"
            tooltip=tooltips.dueDate
            text="Due Date"
            tagName=""
          }}
          <div class="flex-input">
            {{input id="dueDate" name="daterange" type="text" value=dueDate}}
            {{#each dueDateFormErrors as |error|}}
              <p class="error-message">
                {{error}}
              </p>
            {{/each}}
            {{#if invalidDateRange}}
              {{error-box
                error="Invalid Date Range"
                showDismiss=true
                resetError=(action (mut invalidDateRange) null)
              }}
            {{/if}}
          </div>
        </li>
        <li>
          {{assignment-form-label
            for="name"
            tooltip=tooltips.name
            text="Assignment Name"
            tagName=""
          }}
          <div class="flex-input">
            {{input
              type="text"
              placeholder="Give your assignment a name (optional)"
              value=name
            }}
            {{#each nameFormErrors as |error|}}
              <p class="error-message">
                {{error}}
              </p>
            {{/each}}
          </div>
        </li>
        <li class="linked-ws">
          {{assignment-form-label
            for="linkedWorkspaces"
            tooltip=tooltips.linkedWorkspaces
            text="Create Student Workspaces Now?"
            tagName=""
          }}
          {{radio-group
            options=linkedWsOptions
            selectedValue=doCreateLinkedWorkspaces
          }}

          {{#if showLinkedWsForm}}
            {{linked-workspaces-new
              isDisplayOnly=true
              students=selectedSection.students.content
              assignmentName=assignmentNamePreview
              sectionName=selectedSection.name
            }}
          {{/if}}
        </li>
        {{#if doCreateLinkedWorkspaces}}
          <li class="parent-ws">
            {{assignment-form-label
              for="parentWorkspace"
              tooltip=tooltips.parentWorkspace
              text="Create Parent Workspace Now?"
              tagName=""
            }}
            {{radio-group
              options=parentWsOptions
              selectedValue=doCreateParentWorkspace
            }}

            {{#if showParentWsForm}}
              {{parent-workspace-new
                isDisplayOnly=true
                assignmentName=assignmentNamePreview
              }}
            {{/if}}
          </li>
        {{/if}}
      </ol>
    </fieldset>
    {{#if isMissingRequiredFields}}
      <p class="error-message">
        Please provide all required fields.
      </p>
    {{/if}}
  </form>
</section>
<div style="clear: left"></div>
<section class="submit button-row">
  <button class="primary-button" data-test="create" {{action "validate"}}>
    Create Assignment
  </button>
  <button class="primary-button cancel-button" {{action "cancel"}}>
    Cancel
  </button>
</section>
{{#each createRecordErrors as |error|}}
  <p class="error-message">
    {{error}}
  </p>
{{/each}}