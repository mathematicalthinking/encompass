<header class="info-header">
  {{#if isEditing}}
    <h2>Editing Problem</h2>
  {{else}}
    <h2>Problem Details</h2>
  {{/if}}
  <div class="clear"></div>
</header>

<section class="problemdetails">

   {{#if isEditing}}
      <form id='probleminfoform' class='properForm'>
        <fieldset>
          <ol>
            <li>
              <label for="title">Problem Name</label>
              {{input name="title" id="title" type="text" value=problemName}}
            </li>
            <li>
              <label for="text">Problem Statement</label>
              <div class="quill-container">
            <section id="editor"></section>
          </div>
            </li>
            <li class="privacy-settings">
              <label>Privacy Settings
                <span class="required-star">*</span>
              </label>
            {{#if problem.origin}}
              <label class="radio-label">Just Me</label>
            {{else}}
              <input type="radio" checked={{is-equal privacySetting "M"}} required="true" name="privacy" value="M" onclick={{action "radioSelect" "M"}}>
              <label class="radio-label">Just Me</label>
              <input type="radio" checked={{is-equal privacySetting "O"}} required="true" name="privacy" value="O" onclick={{action "radioSelect" "O"}}>
              <label class="radio-label">My Organization</label>
              <input type="radio" checked={{is-equal privacySetting "E"}} required="true" name="privacy" value="E" onclick={{action "radioSelect" "E"}}>
              <label class="radio-label">Everyone</label>
            {{/if}}
            </li>
            <li>
              <label for="imagedata">Problem Image:</label>
              {{#if problem.image}}
                  <a {{action 'toggleImageSize'}} >
                    <img src="{{problem.image.imageData}}" alt="{{problem.title}}" class="{{if isWide "wide"}}">
                  </a>
                  <button class="edit-image-btn" {{action 'deleteImage'}}>Delete</button>
                  {{!-- <button class="edit-image-btn" {{action 'addImage'}}>Add</button> --}}
              {{else}}
                  {{image-upload filesToBeUploaded = filesToBeUploaded hideSubmit = true}}
              {{/if}}
            </li>
          </ol>
        </fieldset>
      </form>
    <button class="action_button" {{action 'checkPrivacy'}}>Save Problem</button>
    <button class="action_button" {{action 'cancelEdit'}}>Cancel</button>
    {{#if canDelete}}
      <button class="right" {{action 'deleteProblem'}}><i class="fa fa-trash" aria-hidden="true"></i></button>
    {{/if}}

  {{else}}

    <section id='probleminfo' class='properForm'>
      <fieldset>
        <ol>
          <li>
            <label for="title">Problem Name</label>
            <p class="problem-info">{{problem.title}}</p>
          </li>
          <li>
            <label for="text">Problem Statement</label>
            <p class="problem-info">{{{problem.text}}}</p>
          </li>

          {{#if problem.origin}}
          <li>
            <label for="origin">Problem Origin</label>
            <p class="problem-info">{{#link-to 'problem' problem.origin.id}}{{problem.origin.title}}{{/link-to}}</p>
          </li>
          {{/if}}

          <li>
            <label for="currentlyPublic">Privacy Setting</label>
            <p class="problem-info">{{privacy-setting problem.privacySetting}}</p>
          </li>
          <li>
            <label for="createDate">Creation Date</label>
            <p class="problem-info">{{format-date problem.createDate 'MMM Do YYYY'}}</p>
          </li>
          {{#if problem.image}}
          <li>
            <label for="imagedata">Problem Image:</label>
              <a {{action 'toggleImageSize'}}>
                <img src="{{problem.image.imageData}}" alt="Image Error" class="{{if isWide "wide"}}">
              </a>
          </li>
          {{/if}}
        </ol>
      </fieldset>
    </section>

      {{#if canEdit}}
        {{#if problem.isUsed}}
          {{#if currentUser.isAdmin}}
            <p class="warning-message">Warning, this problem has an answer. Be sure any changes do not change the intent or difficulty of the problem.</p>
            <button class="action_button" id="editProblem" {{action 'editProblem'}}>Edit Problem</button>
            {{#unless showAssignment}}
              <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
            {{/unless}}
          {{else}}
            <p class="warning-message">You can't edit this problem because an answer has already been submitted.</p>
            <button class="action_button" {{action 'duplicateProblem'}}>Duplicate this Problem</button>
            {{#unless showAssignment}}
              <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
            {{/unless}}
          {{/if}}
        {{else}}
          <button class="action_button" id="editProblem" {{action 'editProblem'}}>Edit Problem</button>
        {{#unless showAssignment}}
          <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
        {{/unless}}
        {{/if}}
      {{else}}
          <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
          <button class="action_button" {{action 'addToMyProblems'}}>Add to My Problems</button>
      {{/if}}

  {{/if}}

</section>

{{#if isMissingRequiredFields}}
  <p class="error-message">Please fill in all required fields.</p>
{{/if}}
{{#each updateProblemErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}
{{#each imageUploadErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}
{{#each createRecordErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}
{{#each findRecordErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}

{{#if isEditing}}
  {{#if showConfirmModal}}
    {{modal-confirm actionToConfirm=showConfirmModal onConfirm="updateProblem" actionName="make your problem public" warningMessage="You are changing your problem's privacy status to public. This means it will be accessible to all EnCoMPASS users. You will not be able to make any changes to this problem once it has been used"}}
  {{/if}}
{{/if}}

{{#if showEditWarning}}
  {{modal-confirm actionToConfirm=showEditWarning onConfirm="continueEdit" actionName="edit a problem that has already been assigned"
  warningMessage="This probably has been used in an assignment but no answers have been submitted yet. Be careful editing this problem"}}
{{/if}}

{{#if showAssignment}}
  {{assignment-new cancel=(action (mut showAssignment) null) fromProblemInfo=true problems=problemList selectedProblem=problem sections=sectionList store=store toAssignmentInfo="toAssignmentInfo"}}
{{/if}}
