<header class="info-header">
  {{#if isEditing}}
    <h2>Editing Problem</h2>
  {{else}}
    <h2>Problem Details</h2>
  {{/if}}
  <div class="clear"></div>
</header>

<section class="problemdetails">

   {{#if isEditing}}
      <form id='probleminfoform' class='properForm'>
        <fieldset>
          <ol>
            <li>
              <label for="title">Problem Name</label>
              {{input name="title" id="title" type="text" value=problemName}}
            </li>
            <li>
              <label for="text">Problem Statement</label>
              <div class="quill-container">
                <section id="editor"></section>
              </div>
            </li>
            <li>
              <label for="categories">Problem Categories</label>
              {{#if problem.categories}}
              <ul class="problem-info">
                {{#each problem.categories as |category|}}
                  <li>{{category.identifier}} <button {{action 'removeCategory' category}}>X</button></li>
                {{/each}}
                  {{#unless showCategories}}
                    <button {{action 'showCategories'}}>Add Categories</button>
                  {{/unless}}
                  {{#if showCategories}}
                    <button {{action 'showCategories'}}>Hide Categories</button>
                    {{categories-menu categories=categoryTree store=store addCategories="addCategories"}}
                  {{/if}}
              </ul>
              {{else}}
                {{#unless showCategories}}
                    <button {{action 'showCategories'}}>Add Categories</button>
                {{/unless}}
                {{#if showCategories}}
                    <button {{action 'showCategories'}}>Hide Categories</button>
                    {{#if categoryTree}}
                      {{categories-menu categories=categoryTree store=store addCategories="addCategories"}}
                    {{/if}}
                {{/if}}
              {{/if}}
            </li>
            <li>
              <label for="additionalInfo">Additional Info</label>
              {{textarea class="additional-info-area" value=additionalInfo rows="3" placeholder="Additional info..."}}
              {{input id="additionalInfo" type="hidden" value=additionalInfo }}
            </li>
            <li class="privacy-settings">
              <label>Privacy Settings
                <span class="required-star">*</span>
              </label>
            {{#if problem.origin}}
              <label class="radio-label">Just Me</label>
            {{else}}
              <input type="radio" checked={{is-equal privacySetting "M"}} required="true" name="privacy" value="M" onclick={{action "radioSelect" "M"}}>
              <label class="radio-label">Just Me</label>
              <input type="radio" checked={{is-equal privacySetting "O"}} required="true" name="privacy" value="O" onclick={{action "radioSelect" "O"}}>
              <label class="radio-label">My Organization</label>
              <input type="radio" checked={{is-equal privacySetting "E"}} required="true" name="privacy" value="E" onclick={{action "radioSelect" "E"}}>
              <label class="radio-label">Everyone</label>
            {{/if}}
            </li>
            <li>
              <label for="imagedata">Problem Image:</label>
              {{#if problem.image}}
                  <a {{action 'toggleImageSize'}} >
                    <img src="{{problem.image.imageData}}" alt="{{problem.title}}" class="{{if isWide "wide"}}">
                  </a>
                  <button class="edit-image-btn" {{action 'deleteImage'}}>Delete</button>
                  {{!-- <button class="edit-image-btn" {{action 'addImage'}}>Add</button> --}}
              {{else}}
                  {{image-upload filesToBeUploaded = filesToBeUploaded hideSubmit = true}}
              {{/if}}
            </li>
          </ol>
        </fieldset>
      </form>
    <button class="action_button" {{action 'checkPrivacy'}}>Save Problem</button>
    <button class="action_button" {{action 'cancelEdit'}}>Cancel</button>
    {{#if canDelete}}
      <button class="right" {{action 'deleteProblem'}}><i class="fa fa-trash" aria-hidden="true"></i></button>
    {{/if}}

  {{else}}

    <section id='probleminfo' class='properForm'>
      <fieldset>
        <ol>
          <li>
            <label for="title">Problem Name</label>
            <p class="problem-info">{{problem.title}}</p>
          </li>
          <li>
            <label for="text">Problem Statement</label>
            <p class="problem-info">{{{problem.text}}}</p>
          </li>
          {{#if problem.categories}}
            <li>
              <label for="text">Problem Categories</label>
              <ul class="problem-info">
              {{#each problem.categories as |category|}}
                <li>
                  <a href="{{category.url}}" target="_blank">{{category.identifier}}</a>
                </li>
              {{/each}}
              </ul>
            </li>
          {{/if}}
          {{#if additionalInfo}}
            <li>
              <label for="additionalInfo">Additional Info</label>
              <p class="problem-info">{{problem.additionalInfo}}</p>
            </li>
          {{/if}}

          {{#if problem.origin}}
          <li>
            <label for="origin">Problem Origin</label>
            <p class="problem-info">{{#link-to 'problem' problem.origin.id}}{{problem.origin.title}}{{/link-to}}</p>
          </li>
          {{/if}}

          <li>
            <label for="currentlyPublic">Privacy Setting</label>
            <p class="problem-info">{{privacy-setting problem.privacySetting}}</p>
          </li>
          <li>
            <label for="createDate">Creation Date</label>
            <p class="problem-info">{{format-date problem.createDate 'MMM Do YYYY'}}</p>
          </li>
          {{#if problem.image}}
          <li>
            <label for="imagedata">Additional Image:</label>
              <a {{action 'toggleImageSize'}}>
                <img src="{{problem.image.imageData}}" alt="Image Error" class="{{if isWide "wide"}}">
              </a>
          </li>
          {{/if}}
        </ol>
      </fieldset>
    </section>

      {{#if canEdit}}
        {{#if problem.isUsed}}
          {{#if currentUser.isAdmin}}
            <p class="warning-message">Warning, this problem has an answer. Be sure any changes do not change the intent or difficulty of the problem.</p>
            <button class="action_button" id="editProblem" {{action 'editProblem'}}>Edit Problem</button>
            {{#unless showAssignment}}
              <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
            {{/unless}}
          {{else}}
            <p class="warning-message">You can't edit this problem because an answer has already been submitted.</p>
            <button class="action_button" {{action 'duplicateProblem'}}>Duplicate this Problem</button>
            {{#unless showAssignment}}
              <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
            {{/unless}}
          {{/if}}
        {{else}}
          <button class="action_button" id="editProblem" {{action 'editProblem'}}>Edit Problem</button>
        {{#unless showAssignment}}
          <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
        {{/unless}}
        {{/if}}
      {{else}}
          <button class="action_button" {{action 'showAssignment'}}>Create Assignment</button>
          <button class="action_button" {{action 'addToMyProblems'}}>Add to My Problems</button>
      {{/if}}

  {{/if}}

</section>

{{#if isMissingRequiredFields}}
  <p class="error-message">Please fill in all required fields.</p>
{{/if}}
{{#each updateProblemErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}
{{#each imageUploadErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}
{{#each createRecordErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}
{{#each findRecordErrors as |error|}}
  <p class="error-message">{{error}}</p>
{{/each}}

{{#if showAssignment}}
  {{assignment-new cancel=(action (mut showAssignment) null) fromProblemInfo=true problems=problemList selectedProblem=problem sections=sectionList store=store toAssignmentInfo="toAssignmentInfo"}}
{{/if}}
